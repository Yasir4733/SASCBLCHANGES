

-- Sql Server SooperWizer
ALTER TABLE [Essentials].[PieceWiseCutReport]
ADD StyleTemplateID INT,
CONSTRAINT FK_PieceWiseCutReport_StyleTemplate
FOREIGN KEY (StyleTemplateID) REFERENCES [Essentials].[StyleTemplate](StyleTemplateID);






-- ==============================================
-- ==============================================


USE [SooperWizer];

 DROP TABLE IF EXISTS [Data].[EndLineFaultLog];
 DROP TABLE IF EXISTS [Data].[EndLineSession];

 CREATE TABLE [Data].[EndLineSession](
 EndLineSessionID INT NOT NULL IDENTITY(1,1),
 LineID INT NOT NULL,
 SectionID INT NOT NULL,
 BundleID INT NOT NULL,
 PieceID INT NOT NULL,
 UserID INT NOT NULL,
 Status TINYINT NOT NULL DEFAULT 0,
 CreatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
 UpdatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
 CONSTRAINT PK_EndLineSessionNew PRIMARY KEY(EndLineSessionID),
 CONSTRAINT FK_EndLineSessionNew_Line FOREIGN KEY(LineID) REFERENCES [Essentials].[Line](LineID),
 CONSTRAINT FK_EndLineSessionNew_Section FOREIGN KEY(SectionID) REFERENCES [Essentials].[Section](SectionID),
 CONSTRAINT FK_EndLineSessionNew_CutReport FOREIGN KEY(BundleID) REFERENCES [Essentials].[CutReport](BundleID),
 CONSTRAINT FK_EndLineSessionNew_PieceWiseCutReport FOREIGN KEY(PieceID) REFERENCES [Essentials].[PieceWiseCutReport](PieceID),
 CONSTRAINT FK_EndLineSessionNew_User FOREIGN KEY(UserID) REFERENCES [Essentials].[User](UserID),
 CONSTRAINT CK_EndLineSessionNew_Status CHECK(Status IN(0,1,2,3,4,5,6,7,8)));



 CREATE TABLE [Data].[EndLineFaultLog](
 EndLineFaultLogID INT NOT NULL IDENTITY(1,1),
 EndLineSessionID INT NOT NULL,
 FaultID INT NOT NULL,
 FaultCount INT NOT NULL,
 PieceWiseScanningID INT NOT NULL,
 CreatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
 UpdatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
 CONSTRAINT PK_EndLineFaultLogNew PRIMARY KEY(EndLineFaultLogID),
 CONSTRAINT FK_EndLineFaultLogNew_EndLineSessionNew FOREIGN KEY(EndLineSessionID) REFERENCES [Data].[EndLineSession](EndLineSessionID),
 CONSTRAINT FK_EndLineFaultLogNew_Fault FOREIGN KEY(FaultID) REFERENCES [Essentials].[Fault](FaultID),
 CONSTRAINT FK_EndLineFaultLogNew_PieceWiseScan FOREIGN KEY(PieceWiseScanningID) REFERENCES [Data].[PieceWiseScan](PieceWiseScanningID)
 );
